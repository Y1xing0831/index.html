<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>D&D Adventure Dashboard</title>
    <style>
        :root {
            --primary: #e63946;    /* æˆ°é¬¥ç´… */
            --secondary: #457b9d;  /* è³‡è¨Šè— */
            --bg: #f1faee;         /* èƒŒæ™¯ç™½ */
            --dark: #1d3557;       /* æ·±åº•è‰² */
            --card: #ffffff;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', system-ui;
            background: var(--bg);
            margin: 0;
            padding-bottom: 70px;
            color: var(--dark);
        }

        /* ä¸»å°è¦½åˆ— */
        nav {
            background: var(--dark);
            color: white;
            display: flex;
            overflow-x: auto;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        nav div {
            padding: 15px 20px;
            cursor: pointer;
            flex-shrink: 0;
            font-weight: bold;
            font-size: 0.9rem;
            transition: 0.3s;
            border-bottom: 3px solid transparent;
        }

        nav div.active {
            background: var(--primary);
            border-bottom: 3px solid white;
        }

        /* é é¢å®¹å™¨ */
        .page {
            display: none;
            padding: 15px;
            max-width: 600px;
            margin: auto;
            animation: fadeIn 0.4s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: var(--card);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        h2 {
            font-size: 1.2rem;
            color: var(--secondary);
            margin-top: 0;
            border-left: 4px solid var(--primary);
            padding-left: 10px;
            margin-bottom: 15px;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .data-label { font-weight: bold; color: #555; font-size: 0.9rem; }
        .data-content { white-space: pre-wrap; text-align: right; font-size: 0.95rem; color: var(--dark); }

        /* æ“²éª°å°ˆå€ */
        .dice-tray {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
            min-height: 60px;
        }

        .dice {
            width: 55px;
            height: 55px;
            background: var(--dark);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            border-radius: 10px;
            box-shadow: 0 4px 0 #000;
        }

        select, input, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 1rem;
            box-sizing: border-box;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        button:active { transform: scale(0.95); opacity: 0.8; }

        .refresh-btn {
            background: var(--secondary);
            margin-top: 10px;
        }
    </style>
</head>
<body>

<nav id="navbar">
    <div onclick="switchPage('dice')" id="nav-dice" class="active">ğŸ² æ“²éª°</div>
    <div onclick="switchPage('char')" id="nav-char">ğŸ‘¤ è§’è‰²</div>
    <div onclick="switchPage('world')" id="nav-world">ğŸŒ ä¸–ç•Œ</div>
    <div onclick="switchPage('quest')" id="nav-quest">ğŸ“œ ä»»å‹™</div>
    <div onclick="switchPage('party')" id="nav-party">ğŸ‘¥ éšŠå‹</div>
</nav>

<div id="dice" class="page active">
    <div class="card">
        <h2>ç™¼èµ·åˆ¤å®š</h2>
        <div style="display: flex; gap: 10px;">
            <select id="diceType">
                <option value="20">D20 (åˆ¤å®š)</option>
                <option value="6">D6 (å‚·å®³)</option>
                <option value="8">D8</option>
                <option value="10">D10</option>
                <option value="12">D12</option>
                <option value="4">D4</option>
            </select>
            <input type="number" id="diceCount" value="1" min="1" style="width: 80px;">
        </div>
        <div id="tray" class="dice-tray"></div>
        <button onclick="runRoll()">ROLL (åŒæ­¥è‡³è©¦ç®—è¡¨)</button>
        <h3 id="total-text" style="text-align:center; display:none;">ç¸½è¨ˆ: 0</h3>
    </div>
</div>

<div id="char" class="page">
    <div class="card">
        <h2>åŸºç¤èº«ä»½</h2>
        <div class="data-row"><span class="data-label">è§’è‰²åç¨±</span><span class="data-content" id="d-Name">è®€å–ä¸­...</span></div>
        <div class="data-row"><span class="data-label">ç¨®æ— / è·æ¥­</span><span class="data-content" id="d-RaceClass">---</span></div>
        <div class="data-row"><span class="data-label">ç­‰ç´š / ç¶“é©—å€¼</span><span class="data-content" id="d-LevelEXP">---</span></div>
    </div>
    <div class="card">
        <h2>æ ¸å¿ƒå±¬æ€§ & ç”Ÿå­˜</h2>
        <div class="data-row"><span class="data-label">å±¬æ€§ (å…­åœ)</span><span class="data-content" id="d-Attributes">---</span></div>
        <div class="data-row"><span class="data-label">HP / AC</span><span class="data-content" id="d-HP_AC">---</span></div>
        <div class="data-row"><span class="data-label">æ³•è¡“ä½ / ç‹€æ…‹</span><span class="data-content" id="d-Spells">---</span></div>
    </div>
    <div class="card">
        <h2>æ¸…å–®ç®¡ç†</h2>
        <b>æŠ€èƒ½è¡¨ï¼š</b><p class="data-content" id="d-Skills" style="text-align:left;">---</p>
        <hr>
        <b>ç‰©å“æ¬„ï¼š</b><p class="data-content" id="d-Inventory" style="text-align:left;">---</p>
    </div>
    <button class="refresh-btn" onclick="loadAllData()">æ‰‹å‹•æ›´æ–°æ•¸æ“š</button>
</div>

<div id="world" class="page">
    <div class="card">
        <h2>ä¸»è¦åœ°å€èˆ‡åŸé®</h2>
        <p id="d-Regions" class="data-content" style="text-align:left;">---</p>
        <p id="d-Towns" class="data-content" style="text-align:left;">---</p>
    </div>
    <div class="card">
        <h2>é‡è¦ NPC</h2>
        <p id="d-NPCs" class="data-content" style="text-align:left;">---</p>
    </div>
    <button class="refresh-btn" onclick="loadAllData()">æ‰‹å‹•æ›´æ–°æ•¸æ“š</button>
</div>

<div id="quest" class="page">
    <div class="card">
        <h2>ç•¶å‰ä½ç½®</h2>
        <p id="d-Location" class="data-content" style="text-align:left; font-weight:bold;">---</p>
    </div>
    <div class="card">
        <h2>ä»»å‹™æ—¥èªŒ</h2>
        <b>ä¸»ç·šä»»å‹™ï¼š</b><p id="d-Main" class="data-content" style="text-align:left;">---</p>
        <b>ç›®å‰ä»»å‹™ï¼š</b><p id="d-Current" class="data-content" style="text-align:left;">---</p>
        <b>å·²å®Œæˆï¼š</b><p id="d-Completed" class="data-content" style="text-align:left; color:gray;">---</p>
    </div>
    <button class="refresh-btn" onclick="loadAllData()">æ‰‹å‹•æ›´æ–°æ•¸æ“š</button>
</div>

<div id="party" class="page">
    <div class="card">
        <h2>å†’éšªå°éšŠ</h2>
        <p id="d-Members" class="data-content" style="text-align:left;">---</p>
    </div>
    <button class="refresh-btn" onclick="loadAllData()">æ‰‹å‹•æ›´æ–°æ•¸æ“š</button>
</div>

<script>
    // âš ï¸ è«‹ç¢ºä¿é€™æ˜¯ä½ æœ€æ–°çš„ GAS ç¶²å€
    const GOOGLE_URL = 'https://script.google.com/macros/s/AKfycbyBI7TAjMQ0fuXluamUxbRrCAXCzmaxkODIix9QJI6Oi7OnD5LhGf-U_RxQgo8Z1CqtYg/exec';

    // åˆ†é åˆ‡æ›é‚è¼¯
    function switchPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('nav div').forEach(d => d.classList.remove('active'));
        
        document.getElementById(id).classList.add('active');
        document.getElementById('nav-' + id).classList.add('active');
        
        // åˆ‡æ›åˆ°éæ“²éª°é é¢æ™‚ï¼Œè‡ªå‹•æŠ“å–æœ€æ–°æ•¸æ“š
        if (id !== 'dice') {
            loadAllData();
        }
    }

    // å¾è©¦ç®—è¡¨æŠ“å–æ‰€æœ‰æ•¸æ“š
    async function loadAllData() {
        try {
            const response = await fetch(GOOGLE_URL);
            const data = await response.json();
            
            // éæ­·æ‰€æœ‰åˆ†é æ•¸æ“šä¸¦å¡«å……åˆ° HTML
            for (let sheetName in data) {
                for (let key in data[sheetName]) {
                    const element = document.getElementById('d-' + key);
                    if (element) {
                        element.innerText = data[sheetName][key] || "ç„¡è³‡æ–™";
                    }
                }
            }
        } catch (error) {
            console.error("æ•¸æ“šè®€å–å¤±æ•—:", error);
        }
    }

    // æ“²éª°åŠŸèƒ½èˆ‡åŒæ­¥
    async function runRoll() {
        const type = document.getElementById('diceType').value;
        const count = parseInt(document.getElementById('diceCount').value);
        const tray = document.getElementById('tray');
        
        if (isNaN(count) || count < 1) return;

        tray.innerHTML = '';
        let results = [];
        let total = 0;

        // ç”¢å‡ºéš¨æ©Ÿçµæœ
        for (let i = 0; i < count; i++) {
            const val = Math.floor(Math.random() * type) + 1;
            results.push(val);
            total += val;

            const diceEl = document.createElement('div');
            diceEl.className = 'dice';
            diceEl.innerText = val;
            tray.appendChild(diceEl);
        }

        document.getElementById('total-text').style.display = 'block';
        document.getElementById('total-text').innerText = "ç¸½è¨ˆ: " + total;

        // åŒæ­¥åˆ°è©¦ç®—è¡¨ (CurrentRoll åˆ†é )
        try {
            await fetch(GOOGLE_URL, {
                method: 'POST',
                mode: 'no-cors', // è§£æ±ºè·¨ç¶²åŸŸå•é¡Œ
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    targetSheet: "CurrentRoll",
                    combo: count + "D" + type,
                    list: results.join(", ")
                })
            });
        } catch (e) {
            console.log("ä¸Šå‚³å¤±æ•—ï¼Œä½†æ“²éª°å·²å®Œæˆ");
        }
    }

    // åˆå§‹åŒ–è®€å–
    window.onload = () => {
        // å¦‚æœæœ‰åˆå§‹è³‡æ–™éœ€æ±‚å¯ä»¥åœ¨æ­¤åŸ·è¡Œ
    };
</script>

</body>
</html>
